<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registro Dinner Educatori</title>
    <style>
        :root {
            --bg:#c7ede6;
            --primary:#4b788d;
            --d1:#ffc10759;
            --d2:#dc354559;
            --ok:#30ec80;
            --no:#ff4d4d;
            --wait:#3984a7;
            --tutti: #228dbf;
            --permessi: #ff8000f8;
            --cambiati: #53b2ef;
            --highlight: #f1c40f;
            --card-bg: #ffffff;
        }

        body { font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background:var(--bg); padding:15px; margin:0; }
        .container { max-width: 1100px; margin: auto; }

        header {
            background: var(--primary); color: #fff; padding: 20px; border-radius: 40px;
            text-align: center; margin-bottom: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }

        #todayDate { font-size: 1.2em; text-transform: capitalize; opacity: 0.9; }
        
        .clock-container {
            display: inline-block;
            margin-top: 10px;
            padding: 10px 25px;
            border-radius: 100px;
            transition: all 0.5s ease;
            background: rgba(0,0,0,0.1);
            font-family: 'Courier New', monospace; font-size: 3em;
            font-weight: bold;
        }

        .clock-blue { background: #4b788d; }
        .clock-yellow { background: #ffc10759; }
        .clock-red { background: #dc354559; }

        .days-container { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px; margin-bottom: 20px; }
        .day-box {
            background: #fff; padding: 0.8px; text-align: center; border-radius: 20px;
            font-size: 0.85em; color: #444; border: 2px solid transparent; box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            cursor: help; transition: all 0.3s ease; line-height: 2.5;
        }
        .day-box.active-day { border-color: var(--primary); background: #e4ebff; color: var(--primary); font-weight: bold; }

        .counter-banner {
            background: var(--primary); color: white; padding: 6px; border-radius: 30px;
            text-align: center; margin-bottom: 15px; display: flex; justify-content: space-around; align-items: center;
        }
        .counter-item { display: flex; flex-direction: column; }
        .counter-num { font-size: 1.5em; font-weight: bold; color: var(--ok); }
        
        #activeGroupBadge { 
            background: #ffffff; color: var(--primary); padding: 5px 15px; 
            border-radius: 50px; font-weight: bold; font-size: 0.8em; 
            box-shadow: 0 2px 5px rgba(0,0,0,0.6);
            display: none;
            animation: pulse 2s infinite; /* Animazione aggiunta */
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(255,255,255, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(255,255,255, 0); }
            100% { box-shadow: 0 0 0 0 rgba(255,255,255, 0); }
        }

        .controls { background: #ffffff; padding: 15px; border-radius: 30px; margin-bottom: 20px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .search-container { display: flex; gap: 10px; margin-bottom: 15px; }
        #searchInput { flex: 1; padding: 10px 20px; border: 1px solid #ddd; border-radius: 50px; outline: none; }
        .btn-clear { background: #95a5a6; color: white; border: none; padding: 0 20px; border-radius: 50px; cursor: pointer; }

        .btn-group { display: flex; gap: 8px; justify-content: center; margin-bottom: 15px; flex-wrap: wrap; }
        .btn { padding: 8px 10px; border: none; border-radius: 50px; color: #000000; font-weight: bold; cursor: pointer; transition: 0.2s; font-size: 0.9em; }
        .btn-reset { background: var(--no); opacity: 0.9; }
        .btn-d1 { background: var(--d1); opacity: 0.6; }
        .btn-d2 { background: var(--d2); opacity: 0.6; }
        .btn-permessi { background: var(--permessi); opacity: 0.6; }
        .btn-cambiati { background: var(--cambiati); opacity: 0.6; }
        .btn.active { opacity: 0.9; transform: scale(1.1); }

        .filter-tags { display: flex; flex-wrap: wrap; gap: 6px; justify-content: center; margin-bottom: 15px; }
        .tag { padding: 6px 14px; background: #dfe6e9; border-radius: 50px; cursor: pointer; font-size: 0.85em; font-weight: 600; }
        .tag.active { background: var(--primary); color: #fff; }

        #listaStudenti {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
            gap: 12px;
            padding-bottom: 100px;
        }

        .student-row {
            background: var(--card-bg); padding: 10px; border-radius: 20px;
            display: flex; flex-direction: column; justify-content: space-between;
            align-items: center; text-align: center; box-shadow: 0 3px 6px rgba(0,0,0,0.06);
            transition: all 0.2s ease; cursor: pointer; border-bottom: 5px solid var(--ok);
            min-height: 110px;
        }

        .student-row.assente { border-bottom-color: var(--no); background: #fdf2f2; opacity: 0.6; }
        .student-row.assente .name { text-decoration: line-through; color: #95a5a6; }

        .student-row.highlight-lab {
            border-bottom-color: var(--highlight); background: var(--highlight) !important;
            transform: scale(1.08); z-index: 10; box-shadow: 0 10px 20px rgba(241, 196, 15, 0.5);
        }

        .name { font-size: 1em; color: #2d3436; margin-bottom: 10px; flex-grow: 1; }
        .name b { display: block; text-transform: uppercase; font-size: 1.1em; }

        .row-actions {
            display: flex; width: 100%; justify-content: space-between;
            align-items: center; border-top: 1px solid #eee; padding-top: 8px;
        }

        .classe-badge { font-weight: bold; color: var(--primary); font-size: 0.9em; }
        
        .btn-switch { background: #f1f2f6; border: none; border-radius: 50%; width: 30px; height: 30px; cursor: pointer; }
    
        .btn-switch.modificato { background: var(--cambiati); color: #ffffff; }

        .group-label { display: inline-block; font-size: 0.7em; background: #d1d8e0; color: #4b6584; padding: .6px 6px; border-radius: 6px; margin-top: 4px; }

        .room-badge { background: #eee; color: #555; font-size: 0.7em; padding: 2px 8px; border-radius: 10px; font-weight: bold; margin-top: 4px;
}
        
        @media (max-width: 480px) { #listaStudenti { grid-template-columns: repeat(2, 1fr); } }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1 style="margin:0; font-size: 1.8em;">Registro Dinner</h1>
        <div id="todayDate"></div>
        <div class="clock-container"><div id="digitalClock">00:00:00</div></div>
    </header>
    
    
    <div class="controls">
        <div class="search-container">
            <input id="searchInput" placeholder="Cerca studente, classe, room" onkeyup="applicaFiltri()">
            <button class="btn-clear" onclick="resetRicerca()">X</button>
        </div>
        
        <div class="filter-tags" id="tagList"><div class="tag active" id="tag-all" onclick="setClasse('Tutte')">Tutte le Classi</div></div>
                
        <div class="btn-group">
            <button class="btn btn-d1" id="btn-d1" onclick="setTurno(1)">18:30</button>
            <button class="btn btn-d2" id="btn-d2" onclick="setTurno(2)">19:15</button>
            <button class="btn btn-permessi" id="btn-perm" onclick="togglePermessi()">Permessi</button>
            <button class="btn btn-cambiati" id="btn-changed" onclick="toggleCambiati()">üîÉ Cambi</button>
       
         <button class="btn" style="background:#689e4b;width:45%; padding: 8px; border-radius: 20px;" onclick="generaPopUpStampa()">üìù RIEPILOGO</button>
    
        
        </div>  
        .
        </div>
    
    
    
    <div class="counter-banner">
        <div class="counter-item"><span>18:30</span><span class="counter-num" id="count1">0</span></div>
        <div class="counter-item"><span>19:15</span><span class="counter-num" id="count2">0</span></div>
        
        <div id="activeGroupBadge">GRUPPO: --</div>
        
        <div class="counter-item"><span>TOTALE</span><span class="counter-num" style="color:#f7ff00" id="countTot">0</span></div>
    </div>


     <div class="days-container" id="daysHeader">   
        <div class="day-box" id="day-1" title="Luned√¨ - PERMESSI: Tessarin No dinner [esce.entra] / Casalicchio dinner ore 18 [esce.entra] / Pignatelli, Menaldino, Chessa dinner ore 20"><b>2IeFP</b></div>
        <div class="day-box" id="day-2" title="Marted√¨ - PERMESSI: Chen, Commod No dinner / Casalicchio, Clerin dinner ore 18 / Lazier, Gaspard, Lunardi dinner ore 20"><b>5A, 5B</b></div>
        <div class="day-box" id="day-3" title="Mercoled√¨ - PERMESSI: Berruti S., D'Agostino, Giovannelli P., No dinner / Casalicchio dinner ore 18 / Saitta dinner ore 19 / Pignatelli, Chessa dinner ore 20"><b>2B</b></div>
        <div class="day-box" id="day-4" title="Gioved√¨ - PERMESSI: Berruti A., Chen, No dinner / Casalicchio, Clerin dinner ore 18 / Menaldino, Chessa dinner ore 20"><b>2A</b></div>
    </div>
    
    <div id="listaStudenti"></div>
</div>

<script>
    function updateClockColor() {
        const clock = document.querySelector('.clock-container');
        const now = new Date();
        const minutes = now.getHours() * 60 + now.getMinutes();

        clock.classList.remove('clock-blue', 'clock-yellow', 'clock-red');

        if (minutes <= 1110 || minutes > 1200) { clock.classList.add('clock-blue'); }
        else if (minutes >= 1111 && minutes <= 1155) { clock.classList.add('clock-yellow'); }
        else if (minutes >= 1156 && minutes <= 1200) { clock.classList.add('clock-red'); }
    }

    updateClockColor();
    setInterval(updateClockColor, 60000);
    
    const TURNI_BASE={ 1:['1A','1B','1P','2A','2B','2P','3P'], 2:['3A','3B','3C','4A','4B','5A','5B'] };
    const OVERRIDE_TURNO_2=['TEBANO'];
    const ASSENTI_CLASSI={ 1:['2P'], 2:['5A','5B'], 3:['2B'], 4:['2A','5A','5B' ] };
    const TUTTI_PERMESSI = ['TESSARIN','CASALICCHIO','PIGNATELLI','MENALDINO','CHESSA','CHEN','COMMOD','CLERIN',
                            'LAZIER','BERRUTI S.','DAGOSTINO','GIOVANNELLI P.','SAITTA','BERRUTI A.','LUNARDI', 'GASPARD'];
    const ASSENTI_PERMESSO={ 1:['TESSARIN','CASALICCHIO','PIGNATELLI','MENALDINO','CHESSA'], 2:['CHEN','COMMOD','CASALICCHIO',
                            'CLERIN','LAZIER', 'LUNARDI', 'GASPARD'], 3:['BERRUTI S.','DAGOSTINO','GIOVANNELLI P.','CASALICCHIO',
                            'SAITTA','PIGNATELLI','CHESSA'], 4:['BERRUTI A.','CHEN','CASALICCHIO','CLERIN','MENALDINO','CHESSA'] };
    
    const CALENDARIO_GRUPPI = { 
        "20/01/2026": "gr1", "22/01/2026": "gr1", "27/01/2026": "gr2", "29/01/2026": "gr2", "03/02/2026": "gr1",  "05/02/2026": "gr1", "10/02/2026": "gr2", "12/02/2026": "gr2",
        "17/02/2026": "gr1", "19/02/2026": "gr1", "24/02/2026": "gr2", "26/02/2026": "gr2", "03/03/2026": "gr1", "05/03/2026": "gr1", "10/03/2026": "gr2", "12/03/2026": "gr2", 
        "17/03/2026": "gr1", "19/03/2026": "gr1", "24/03/2026": "gr2", "26/03/2026": "gr2", "31/03/2026": "gr1", "02/04/2026": "gr1", "07/04/2026": "gr2", "09/04/2026": "gr2", 
        "14/04/2026": "gr1", "16/04/2026": "gr1", "21/04/2026": "gr2", "23/04/2026": "gr2", "28/04/2026": "gr1", "30/04/2026": "gr1", "05/05/2026": "gr2", "07/05/2026": "gr2", 
        "12/05/2026": "gr1", "14/05/2026": "gr1", "19/05/2026": "gr2", "21/05/2026": "gr2", "26/05/2026": "gr1", "28/05/2026": "gr1" 
    };

   const studenti=[ 
                <!-- Classe 1A -->
        { cognome: "COMMOD", nome: "Gaia", classe: "1A", room:"218" },
        { cognome: "GASPARD", nome: "Thierry", classe: "1A", room:"105" },
        { cognome: "JANS", nome: "Giada", classe: "1A", room:"203" },
        { cognome: "OBETTI", nome: "Virginia", classe: "1A", room:"203" },
        { cognome: "PETTORALI", nome: "Matilde", classe: "1A", room:"203" },
        { cognome: "ZIGGIOTTO", nome: "Beatrice", classe: "1A", room:"211" },
                <!-- Classe 1B -->
        { cognome: "BLANCHET", nome: "Nadine", classe: "1B", room:"221" },
        { cognome: "BOMBONATO", nome: "Francesco", classe: "1B", room:"104" },
        { cognome: "DATTRINO", nome: "Nicolas", classe: "1B", room:"105" },
        { cognome: "GIOVANDO", nome: "Caterina", classe: "1B", room:"206" },
        { cognome: "LUNARDI", nome: "Filippo", classe: "1B", room:"108" },
        { cognome: "POUJOL", nome: "Chiara", classe: "1B", room:"206" },
        { cognome: "QUERIO GIANETTO", nome: "Giorgio", classe: "1B", room:"104" },
        { cognome: "SALVI", nome: "Sophie", classe: "1B", room:"206" },
        { cognome: "SCHIRRU", nome: "Didier F√©licien Herv√©", classe: "1B", room:"108" },
        { cognome: "VILARDO", nome: "Gabriele", classe: "1B", room:"104" },
                <!-- Classe 1P -->
        { cognome: "BOUKHRIS", nome: "Chams Jacopo", classe: "1P", room:"107" },
        { cognome: "CHABLOZ", nome: "Annette", classe: "1P", room:"213" },
        { cognome: "DAGOSTINO", nome: "Domenico", classe: "1P", room:"109" },
        { cognome: "FURLAN", nome: "Alessandro", classe: "1P", room:"111" },
        { cognome: "GIOVANNELLI P.", nome: "Pietro", classe: "1P", room:"106" },
        { cognome: "GUIZZETTI RINCON", nome: "Francisco Andres", classe: "1P", room:"105" },
        { cognome: "LAI", nome: "Stefano", classe: "1P", room:"106" },
        { cognome: "LAZIER", nome: "Francesco", classe: "1P", room:"106" },
        { cognome: "PAONESSA", nome: "Leonardo", classe: "1P", room:"107" },
        { cognome: "VINCENT", nome: "Thomas", classe: "1P", room:"103" },
        { cognome: "RUSCI DI LUCA", nome: "Greta", classe: "1P", room:"212" },
        { cognome: "SILVANI", nome: "Amelie", classe: "1P", room:"204" },
                <!-- Classe 2A -->
        { cognome: "BARAVALLE", nome: "Andrea", classe: "2A", room:"102" },
        { cognome: "BERTOT", nome: "Manuele", classe: "2A", room:"102" },
        { cognome: "BUZZI", nome: "Alessandro", classe: "2A", room:"102" },
        { cognome: "CASTELLANO", nome: "Martina", classe: "2A", room:"204" },
        { cognome: "DA FRE", nome: "Gaia", classe: "2A", room:"207" },
        { cognome: "DE GASPER", nome: "Lara", classe: "2A", room:"207" },
        { cognome: "GARCIA", nome: "Luis Alberto", classe: "2A", room:"118" },
        { cognome: "HERESAZ", nome: "Alyce", classe: "2A", room:"211" },
        { cognome: "PENNARD", nome: "Serena", classe: "2A", room:"211" },
        { cognome: "SAITTA", nome: "Asia", classe: "2A", room:"207" },
                <!-- Classe 2B -->
        { cognome: "CHEN", nome: "Michael Jianhao", classe: "2B", room:"103" },
        { cognome: "DELL'AQUILA", nome: "Gabriele", classe: "2B", room:"107" },
        { cognome: "DUNAND", nome: "Audrey", classe: "2B", room:"218" },
        { cognome: "GHILARDINI", nome: "Leonardo", classe: "2B", room:"114" },
        { cognome: "MAINO", nome: "Giada", classe: "2B", room:"218" },
        { cognome: "MISERENDINO", nome: "Ludovica", classe: "2B", room:"204" },
        { cognome: "MOUNIM", nome: "Yahya", classe: "2B", room:"109" },
        { cognome: "PEZZOLI", nome: "Niccol√≤", classe: "2B", room:"101" },
        { cognome: "TACCONE", nome: "Nicholas", classe: "2B", room:"109" },
                <!-- Classe 2P -->
        { cognome: "BERRIAD", nome: "Thierry", classe: "2P", room:"121" },
        { cognome: "BERRUTI A.", nome: "Andrea", classe: "2P", room:"114" },
        { cognome: "BERRUTI S.", nome: "Stefano", classe: "2P", room:"114" },
        { cognome: "CASALICCHIO", nome: "Nahuel", classe: "2P", room:"121" },
        { cognome: "CLERIN", nome: "Pietro", classe: "2P", room:"110" },
        { cognome: "DONZEL", nome: "Elodie", classe: "2P", room:"213" },
        { cognome: "GENS", nome: "Aaron", classe: "2P", room:"101" },
        { cognome: "HERRERA", nome: "Alexander", classe: "2P", room:"115" },
        { cognome: "MONTERO", nome: "Karen", classe: "2P", room:"209" },
        { cognome: "PERRIN", nome: "Annie", classe: "2P", room:"213" },
        { cognome: "STEVENIN", nome: "Joelle", classe: "2P", room:"208" },
        { cognome: "TORTORELLI C.", nome: "Carlotta", classe: "2P", room:"209" },
        { cognome: "TORTORELLI G.", nome: "Greta", classe: "2P", room:"209" },
                <!-- Classe 3P -->
        { cognome: "CONSOL", nome: "Gaia", classe: "3P", room:"208" },
        { cognome: "COSTANZA", nome: "Marcello", classe: "3P", room:"124" },
        { cognome: "LAGOMARSINI", nome: "Michele", classe: "3P", room:"111" },
        { cognome: "LLESHI", nome: "Gabriele", classe: "3P", room:"115" },
        { cognome: "MARRERO", nome: "Lewis", classe: "3P", room:"115" },
        { cognome: "RONCO", nome: "Angelica", classe: "3P", room:"208" },
                <!-- Classe 3A -->
        { cognome: "CATTARINUSSI", nome: "Samuele", classe: "3A", room:"101" },
        { cognome: "FLORIAN", nome: "Gabriele", classe: "3A", room:"118" },
        { cognome: "MARANGELO", nome: "Giulio", classe: "3A", room:"118" },
        { cognome: "PEAQUIN", nome: "Linda", classe: "3A", room:"214" },
        { cognome: "ZOPPO", nome: "Rodrigue", classe: "3A", room:"121" },
                <!-- Classe 3B -->
        { cognome: "BLANCHET", nome: "Magalie", classe: "3B", room:"214" },
        { cognome: "BOGGIA", nome: "Vittoria", classe: "3B", room:"214" },
        { cognome: "CIRINA", nome: "Lorenzo", classe: "3B", room:"110" },
        { cognome: "DUBLANC", nome: "Nicole", classe: "3B", room:"202" },
        { cognome: "GRANATA", nome: "Gabriele", classe: "3B", room:"110" },
        { cognome: "PRUTEANU", nome: "Mihai Giuliano", classe: "3B", room:"116" },
        { cognome: "TRIOLO", nome: "Eleonora", classe: "3B", room:"214" },
                <!-- Classe 3C -->
        { cognome: "CELESIA M.", nome: "Marta", classe: "3C", room:"215" },
        { cognome: "COSTABLOZ", nome: "Giorgia", classe: "3C", room:"202" },
        { cognome: "CUMINO", nome: "Lucia", classe: "3C", room:"205" },
        { cognome: "EPICOCO", nome: "Angelica", classe: "3C", room:"205" },
        { cognome: "MERLET", nome: "Cedric", classe: "3C", room:"123" },
        { cognome: "PALMISANO", nome: "Clarissa", classe: "3C", room:"202" },
        { cognome: "TARTIN", nome: "Zoe", classe: "3C", room:"215" },
                <!-- Classe 4A -->
        { cognome: "CHIADO'", nome: "Diego", classe: "4A", room:"113" },
        { cognome: "COMIOTTO", nome: "Lucia", classe: "4A", room:"216" },
        { cognome: "CONTA", nome: "Giovanni", classe: "4A", room:"125" },
        { cognome: "CROCE", nome: "Giacomo", classe: "4A", room:"117" },
        { cognome: "DANNA", nome: "Gioele", classe: "4A", room:"119" },
        { cognome: "DI TRIA", nome: "Alice", classe: "4A", room:"220" },
        { cognome: "MANCUSO", nome: "Gaia", classe: "4A", room:"219" },
        { cognome: "MARCIANO", nome: "Alberto", classe: "4A", room:"116" },
        { cognome: "MENALDINO", nome: "Moreno", classe: "4A", room:"113" },
        { cognome: "NAVARRETTA", nome: "Alexis Denis Fabien", classe: "4A", room:"113" },
        { cognome: "OBERTO", nome: "Debora", classe: "4A", room:"210" },
        { cognome: "TAPPELLA", nome: "Luca", classe: "4A", room:"116" },
        { cognome: "TESSARIN", nome: "Sharon", classe: "4A", room:"205" },
        { cognome: "VIOT", nome: "Cecilia", classe: "4A", room:"210" },
                <!-- TEBANO 2* DINNER -->
        { cognome: "TEBANO", nome: "Serena", classe: "3P", room:"212" },
                <!-- Classe 4B -->
        { cognome: "CHESSA", nome: "Samuele", classe: "4B", room:"111" },
        { cognome: "FAVRE", nome: "Emilie", classe: "4B", room:"217" },
        { cognome: "GIOVANNELLI T.", nome: "Tommaso", classe: "4B", room:"117" },
        { cognome: "GORREX", nome: "Valerie", classe: "4B", room:"212" },
        { cognome: "HACHEMAOUI", nome: "Slimane Raffaello", classe: "4B", room:"117" },
        { cognome: "MEYNET", nome: "Riccardo", classe: "4B", room:"113" },
        { cognome: "NICOLASI", nome: "Ginevra", classe: "4B", room:"217" },
        { cognome: "SAVELLA", nome: "Ilaria", classe: "4B", room:"210" },
        { cognome: "SERIO", nome: "Federica", classe: "4B", room:"217" },
                <!-- Classe 5A -->
        { cognome: "CARRUOZZO", nome: "Amalia", classe: "5A", gruppo: "G1", room:"201" },
        { cognome: "CELESIA A.", nome: "Alessio", classe: "5A", gruppo: "G2", room:"120" },
        { cognome: "DE GATTIS", nome: "Eleonora", classe: "5A", gruppo: "G2", room:"219" },
        { cognome: "OBERT", nome: "Tommy", classe: "5A", gruppo: "G2", room:"123" },
        { cognome: "PETRIS", nome: "Maurizio", classe: "5A", gruppo: "G2", room:"123" },
        { cognome: "PICCOLI", nome: "Greta", classe: "5A", gruppo: "G1", room:"201" },
        { cognome: "PIGNATELLI", nome: "Maria Vittoria", classe: "5A", gruppo: "G1", room:"201" },
        { cognome: "RASO", nome: "Beatrice", classe: "5A", gruppo: "G2", room:"220" },
        { cognome: "SALVADORI", nome: "Emile", classe: "5A", gruppo: "G2", room:"124" },
        { cognome: "SORRENTI", nome: "Gabriele", classe: "5A", gruppo: "G1", room:"120" },
        { cognome: "VALLOMY", nome: "Etienne", classe: "5A", gruppo: "G2", room:"124" },
        { cognome: "VIGLIANO", nome: "Jacopo", classe: "5A", gruppo: "G1", room:"120" },
                <!-- Classe 5B -->
        { cognome: "CHREIM", nome: "Khadij√©", classe: "5B", gruppo: "G1", room:"221" },
        { cognome: "CORVO", nome: "Filippo", classe: "5B", gruppo: "G1", room:"119" },
        { cognome: "COTTINO", nome: "Jacqueline", classe: "5B", gruppo: "G1", room:"219" },
        { cognome: "KOUROUMA", nome: "Nora", classe: "5B", gruppo: "G2", room:"215" },
        { cognome: "LINTY", nome: "Alys", classe: "5B", gruppo: "G1", room:"216" },
        { cognome: "MARGUERETTAZ", nome: "Greta", classe: "5B", gruppo: "G2", room:"221" },
        { cognome: "MILLERY", nome: "Mathieu", classe: "5B", gruppo: "G2", room:"124" },
        { cognome: "RABAGLIO", nome: "Filippo", classe: "5B", gruppo: "G1", room:"119" }
    ];

    let filtroDinner=null, filtroClasse='Tutte', soloPermessi=false, soloCambiati=false, cambiTurnoManuali = {}; 

    function init(){
        const d=new Date(), g=d.getDay();
        const opzioni = { weekday: 'long', day: 'numeric', month: 'long' };
        document.getElementById('todayDate').innerText = d.toLocaleDateString('it-IT', opzioni);
        updateClock(); setInterval(updateClock, 1000);
        if(g >= 1 && g <= 4) document.getElementById('day-'+g).classList.add('active-day');

        const tagList=document.getElementById('tagList');
        const classiUniche = [...new Set(studenti.map(s=>s.classe))].sort();
        classiUniche.forEach(c=>{
            let t=document.createElement('div'); t.className='tag'; t.id='tag-'+c; t.innerText=c;
            t.onclick=()=>setClasse(c); tagList.appendChild(t);
        });

       const lista = document.getElementById('listaStudenti');
        studenti.forEach(s => {
            let r = document.createElement('div');
            r.className = 'student-row'; 
            r.dataset.classe = s.classe; 
            r.dataset.cognome = s.cognome; 
            r.dataset.gruppo = s.gruppo || ""; 
            r.dataset.nomeCompleto = s.cognome + ' ' + s.nome;
            r.dataset.room = s.room || "";
            
            // Gestione badge dinamici
            const gruppoBadge = s.gruppo ? `<span class="group-label">${s.gruppo}</span>` : "";
            const roomBadge = s.room ? `<div style="font-size:0.8em; color:#666; font-weight:bold; margin-top:5px;">room: ${s.room}</div>` : "";

            r.innerHTML = `
                <div class="name">
                    <b>${s.cognome}</b> ${s.nome} 
                    ${gruppoBadge}
                    ${roomBadge}
                </div>
                <div class="row-actions">
                    <span class="classe-badge">${s.classe}</span>
                    <button class="btn-switch" onclick="switchTurno('${s.cognome}', event)">üîÉ</button>
                </div>`;
                
            r.onclick = (e) => { 
                if(e.target.tagName !== 'BUTTON') { 
                    r.classList.toggle('assente'); 
                    aggiornaContatori(); 
                } 
            };
            lista.appendChild(r);
       
        });

        setupHoverGiorno(); assenzeAutomatiche(g); aggiornaContatori();
    }

    function updateClock() {
        const ora = new Date();
        document.getElementById('digitalClock').innerText = ora.toLocaleTimeString('it-IT');
    }

    function setupHoverGiorno() {
        document.querySelectorAll('.day-box').forEach(box => {
            box.onmouseenter = () => {
                const idG = box.id.split('-')[1];
                const nomi = ASSENTI_PERMESSO[idG] || [];
                document.querySelectorAll('.student-row').forEach(row => { if (nomi.includes(row.dataset.cognome)) row.classList.add('highlight-lab'); });
            };
            box.onmouseleave = () => document.querySelectorAll('.student-row').forEach(row => row.classList.remove('highlight-lab'));
        });
    }

    function assenzeAutomatiche(g) {
        const oggi = new Date();
        const martedi = new Date(oggi);
        const diff = oggi.getDay() === 0 ? -5 : 2 - oggi.getDay(); 
        martedi.setDate(oggi.getDate() + diff);
        const dataStr = martedi.toLocaleDateString('it-IT', { day: '2-digit', month: '2-digit', year: 'numeric' });
        const gruppoInLaboratorio = CALENDARIO_GRUPPI[dataStr]; 

        const badge = document.getElementById('activeGroupBadge');
        if ((g === 2 || g === 4) && gruppoInLaboratorio) {
    badge.style.display = 'inline-block';
    badge.innerText = `Ma/Gi: ${gruppoInLaboratorio.toUpperCase()}`;
} else {
    badge.style.display = 'none';

        }

       document.querySelectorAll('.student-row').forEach(r => {
    r.classList.remove('assente'); 
    const classe = r.dataset.classe;
    const cognome = r.dataset.cognome;
    const gruppoStudente = r.dataset.gruppo; 

    // Logica Laboratorio (GR1/GR2): Attiva il MARTED√å (2) e il GIOVED√å (4)
    // Solo per le classi 5A e 5B
    if ((g === 2 || g === 4) && (classe === '5A' || classe === '5B')) {
        if (gruppoInLaboratorio && gruppoStudente === gruppoInLaboratorio) {
            r.classList.add('assente');
        }
    } 
    
    // Logica assenze per classi intere (esclusa la 5A/5B che √® gestita sopra)
    if (classe !== '5A' && classe !== '5B') {
        if (ASSENTI_CLASSI[g]?.includes(classe)) { 
            r.classList.add('assente'); 
        }
    }

    // Logica assenze per singoli permessi (cognome)
    if (ASSENTI_PERMESSO[g]?.includes(cognome)) { 
        r.classList.add('assente'); 
    }
       });
    }

    function switchTurno(cognome, event) {
        event.stopPropagation();
        const r = document.querySelector(`.student-row[data-cognome="${cognome}"]`);
        const btn = event.currentTarget;
        let t = turnoStudente(r.dataset.classe, cognome);
        if (cambiTurnoManuali[cognome]) { delete cambiTurnoManuali[cognome]; btn.classList.remove('modificato'); }
        else { cambiTurnoManuali[cognome] = (t === 1) ? 2 : 1; btn.classList.add('modificato'); }
        aggiornaContatori(); applicaFiltri();
    }

    function aggiornaContatori(){
        let p1=0, p2=0;
        document.querySelectorAll('.student-row').forEach(r=>{
            if(!r.classList.contains('assente')){
                if(turnoStudente(r.dataset.classe,r.dataset.cognome)===1) p1++; else p2++;
            }
        });
        document.getElementById('count1').innerText = p1;
        document.getElementById('count2').innerText = p2;
        document.getElementById('countTot').innerText = p1 + p2; 
    }

    function turnoStudente(cl, cog){
        if(cambiTurnoManuali[cog]) return cambiTurnoManuali[cog];
        const g = new Date().getDay();
        if(cog === "SAITTA" && g === 3) return 2;
        if(OVERRIDE_TURNO_2.includes(cog) || !TURNI_BASE[1].includes(cl)) return 2;
        return 1;
    }

    function setTurno(n){ filtroDinner = (filtroDinner === n) ? null : n; soloPermessi = false; soloCambiati = false; aggiornaStatoPulsanti(filtroDinner ? 'btn-d'+n : null); applicaFiltri(); }
    function togglePermessi() { soloPermessi = !soloPermessi; filtroDinner = null; soloCambiati = false; aggiornaStatoPulsanti(soloPermessi ? 'btn-perm' : null); applicaFiltri(); }
    function toggleCambiati() { soloCambiati = !soloCambiati; filtroDinner = null; soloPermessi = false; aggiornaStatoPulsanti(soloCambiati ? 'btn-changed' : null); applicaFiltri(); }
    function aggiornaStatoPulsanti(id) { document.querySelectorAll('.btn-group .btn').forEach(b => b.classList.remove('active')); if(id) document.getElementById(id).classList.add('active'); }
    function setClasse(c){ filtroClasse=c; document.querySelectorAll('.tag').forEach(t=>t.classList.remove('active')); document.getElementById(c==='Tutte'?'tag-all':'tag-'+c).classList.add('active'); applicaFiltri(); }

    function applicaFiltri(){
    const s = document.getElementById('searchInput').value.toLowerCase();
    document.querySelectorAll('.student-row').forEach(r => {
        const t = turnoStudente(r.dataset.classe, r.dataset.cognome);
        
        // Logica di ricerca: Nome/Cognome OR Classe OR Stanza
        const mS = r.dataset.nomeCompleto.toLowerCase().includes(s) || 
                   r.dataset.classe.toLowerCase().includes(s) ||
                   r.dataset.room.toLowerCase().includes(s); // <--- NUOVO CONTROLLO
        
        const mT = filtroDinner ? t === filtroDinner : true;
        const mC = filtroClasse === 'Tutte' || r.dataset.classe === filtroClasse;
        const mP = soloPermessi ? TUTTI_PERMESSI.includes(r.dataset.cognome) : true;
        const mCh = soloCambiati ? cambiTurnoManuali[r.dataset.cognome] != undefined : true;
        
        r.style.display = (mS && mT && mC && mP && mCh) ? 'flex' : 'none';
    });
}
   

    function resetRicerca() { document.getElementById('searchInput').value = ''; filtroDinner=null; soloPermessi=false; soloCambiati=false; filtroClasse='Tutte'; aggiornaStatoPulsanti(null); setClasse('Tutte'); applicaFiltri(); }
    
    function generaPopUpStampa() {
        let a1=0, p1=0, a2=0, p2=0, n1=[], n2=[], switch1=[], switch2=[];
        document.querySelectorAll('.student-row').forEach(r=>{
            const cognome = r.dataset.cognome;
            const t = turnoStudente(r.dataset.classe, cognome);
            const a = r.classList.contains('assente');
            const nome = r.dataset.nomeCompleto;
            if(t===1){ a?(a1++,n1.push(nome)):p1++; }
            if(t===2){ a?(a2++,n2.push(nome)):p2++; }
            if(cambiTurnoManuali[cognome]){
                if(t===1) switch1.push(nome + " (da 2¬∞ a 1¬∞)");
                else switch2.push(nome + " (da 1¬∞ a 2¬∞)");
            }
        });

        const dataStampa = document.getElementById('todayDate').innerText;
        const g = new Date().getDay();
        const testiPermessi = {
            1: "LAB 2IeFP - PERMESSI: Tessarin NO dinner / Casalicchio dinner ore 18 / Pignatelli, Menaldino, Chessa dinner ore 20",
            2: "LAB 5A-5B - PERMESSI: Chen, Commod NO dinner / Casalicchio, Clerin dinner ore 18 / Lazier, Lunardi, Gaspard dinner ore 20",
            3: "LAB 2B - PERMESSI: Berruti S., D'Agostino, Giovannelli P. NO dinner / Casalicchio dinner ore 18 / Saitta dinner ore 19 / Pignatelli, Chessa dinner ore 20",
            4: "LAB 2A - PERMESSI: Berruti A., Chen NO dinner / Casalicchio, Clerin dinner ore 18 / Menaldino, Chessa dinner ore 20"
        };
        const notaGiornoCorrente = testiPermessi[g] || "";

        const popup = window.open('', '_blank', 'width=900,height=800');
        popup.document.write(`
            <html><head><title>Conteggi Dinner</title><style>
                body { font-family: sans-serif; padding: 40px; }
                h2 { text-align: center; text-transform: uppercase; }
                .date { text-align: center; font-size: 1.2em; margin-bottom: 20px;}
                .editable-notes { width: 100%; border: 1px dashed #ccc; font-size: 1.1em; font-weight: bold; text-align: center; text-transform: uppercase; padding: 10px; margin-bottom: 20px;}
                .section { margin-bottom: 30px; border-left: 6px solid #333; padding-left: 20px; }
                .stats-row { display: flex; gap: 20px; align-items: center; flex-wrap: wrap; }
                input { font-size: 1.5em; font-weight: bold; width: 60px; border: none; border-bottom: 2px solid #000; text-align: center; }
                .nomi { font-size: 0.85em; color: #444; font-style: italic; margin-top: 10px; line-height: 1.4; }
                .cambi { font-size: 0.85em; color: #444; font-style: italic; margin-top: 5px; }
                .no-print { margin-top: 30px; display: flex; justify-content: center; }
                @media print { .no-print { display: none; } .editable-notes { border: none; } }
            </style></head><body>
                <h2>Conteggi Dinner</h2>
                <div class="date">${dataStampa}</div>
                <textarea class="editable-notes" rows="2">${notaGiornoCorrente}</textarea>
                <div class="section">
                    <h3>1¬∞ DINNER ore 18:30 Classi: 1A, 1B, 1P, 2A, 2B, 2P, 3P</h3>
                    <div class="stats-row">
                        <span>Assenti: <input type="number" value="${a1}"></span>
                        <span>Presenti: <input type="number" value="${p1}"></span>
                        <span>+ EDU: <input type="number" value="2"></span> + <input type="text" id="altroDettaglioLab1" placeholder="..." style="width: 250px; font-size: 1.0em;">
                    </div>
                    <div class="nomi"><b>Esclusi:</b> ${n1.length ? n1.join(', ') : 'Nessuno'}</div>
                    <div class="cambi"><b>Cambi Turno:</b> ${switch1.length ? switch1.join(', ') : 'Nessuno'}</div>
                </div>
                <div class="section">
                    <h3>2¬∞ DINNER ore 19:15 Classi: 3A, 3B, 3C, 4A, 4B, 5A, 5B</h3>
                    <div class="stats-row">
                        <span>Assenti: <input type="number" value="${a2}"></span>
                        <span>Presenti: <input type="number" value="${p2}"></span>
                        <span>+ EDU: <input type="number" value="2"></span>
                    + <input type="text" id="altroDettaglioLab2" placeholder="..." style="width: 250px; font-size: 1.0em;">
                    </div>
                    <div class="nomi"><b>Esclusi:</b> ${n2.length ? n2.join(', ') : 'Nessuno'}</div>
                    <div class="cambi"><b>Cambi Turno:</b> ${switch2.length ? switch2.join(', ') : 'Nessuno'}</div>
                </div>
                <div class="no-print"><button onclick="window.print()" style="padding:15px 50px; background:#27ae60; color:white; font-weight:bold; border-radius:80px; border:none; cursor:pointer;">STAMPA</button></div>
            </body></html>
        `);
        popup.document.close();
    }
    window.onload = init;
</script>
</body>
</html>
